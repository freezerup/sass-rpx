<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>three.js进行场景布置</title>
    <script src="./libs/three.js"></script>
    <script src="./libs/stats.js"></script>
    <script src="./libs/dat.gui.js"></script>
    <style>
      body { margin: 0; }
      canvas { width: 100%; height: 100% }
    </style>
</head>
<body onload="init()">
  <div id="canvas"></div>
  <div id="stats"></div>
<script>
  function initStats(type) {
    const panelType = (typeof type !== 'undefined' && type) && (isNaN(type)) ? parseInt(type) : 0;
    const stats = new Stats();
    stats.showPanel(panelType); // 0:fps; 1:ms; 3+:custom
    document.getElementById("stats").appendChild(stats.domElement);
    return stats;
  }
</script>

<script>
  const guiOptions = function() {
    this.rotationSpeed = 0.02;
    this.bouncingSpeed = 0.03;
  }
  function initGui() {
    const options = new guiOptions();
    const gui = new dat.GUI();
    gui.add(options, 'rotationSpeed', 0, 0.5);
    gui.add(options, 'bouncingSpeed', 0, 0.5);
    return options
  }
</script>

<script>
  let scene, renderer, camera
  function init() {
    const options = initGui();
    const stats = initStats();
    // 场景
    scene = new THREE.Scene();
    // 雾化效果
    scene.fog = new THREE.Fog(0xefefef, 0.015, 100);
    
    // 渲染器
    renderer = new THREE.WebGLRenderer();
    renderer.setClearColor(new THREE.Color(0xEEEEEE, 1.0));
    renderer.setSize(window.innerWidth, window.innerHeight);
    renderer.shadowMap.enabled = true;
    // 摄像机 
    camera = new THREE.PerspectiveCamera(45, window.innerWidth / window.innerHeight, 0.1, 1000)
    const cameraHelper = new THREE.CameraHelper( camera );
    scene.add( cameraHelper );

    // 添加物体
    const plane = createPlane();
    scene.add(plane); // 平面 
    const box = createBox();
    scene.add(box); // 长方形
    const sphere = createSphere();
    scene.add(sphere); // 圆形

    camera.position.set(-30, 40, 30)
    camera.lookAt(scene.position)

    // 添加光源
    scene.add(createSpotLight()); // 光源
    scene.add(createAmbienLight()); // 基础光源

    document.getElementById('canvas').appendChild( renderer.domElement );
    let step = 0;
    renderScene();
    function renderScene() {
      step += options.bouncingSpeed;;
      stats.update();
      boxAnimation(box, options);
      sphereAnimation(sphere, step);
      requestAnimationFrame(renderScene);
      renderer.render(scene, camera);
    }
  }

  function boxAnimation(box, options) {
    box.rotation.x += options.rotationSpeed;
    box.rotation.y += options.rotationSpeed;
    box.rotation.z += options.rotationSpeed;
  }

  function sphereAnimation(sphere, step) {
    sphere.position.x = 20 + ( 10 * (Math.cos(step)));
    sphere.position.y = 2 + ( 10 * Math.abs(Math.sin(step)));
  }

  // 设置物体
  function createPlane() {
    const geometry = new THREE.PlaneGeometry( 60, 20 );
    const material = new THREE.MeshLambertMaterial( { color: 0xFFFFFF} );
    const plane = new THREE.Mesh( geometry, material );
    plane.receiveShadow = true; // 是否接收阴影
    plane.rotation.x = -0.5 * Math.PI;
    plane.position.set(15, 0, 0)
    return plane
  }

  function createBox() {
    const geometry = new THREE.BoxGeometry( 4, 4, 4 );
    const material = new THREE.MeshLambertMaterial( { color: 0xFF0000 } );
    const box = new THREE.Mesh( geometry, material );
    box.position.set(-4, 3, 0);
    return box;
  }

  function createSphere() {
    const geometry = new THREE.SphereGeometry( 4, 20, 20 );
    const material = new THREE.MeshLambertMaterial( { color: 0x7777FF } );
    const sphere = new THREE.Mesh( geometry, material );
    sphere.castShadow = true; // 是否投射阴影
    sphere.position.set(20, 4, 2);
    return sphere;
  }

  // 光源
  function createSpotLight() {
    const spotLight = new THREE.SpotLight(0xFFFFFF);
    spotLight.position.set(-10, 20, -5);
    // 是否产生印象效果,及阴影效果
    spotLight.castShadow = true;
    // spotLight.shadow.mapSize = new THREE.Vector2(1024, 1024);
    // spotLight.shadow.camera.far = 130;
    // spotLight.shadow.camera.near = 40;
    return spotLight
  }

  function createAmbienLight() {
    const ambienLight = new THREE.AmbientLight(0x353535);
    return ambienLight
  }


  // 监听屏幕变化
  function onResize() {
    camera.aspect = window.innerWidth / window.innerHeight;
    camera.updateProjectionMatrix();
    renderer.setSize(window.innerWidth, window.innerHeight);
  }
  window.addEventListener('resize', onResize, false)
</script>
</body>
</html>